<!DOCTYPE html>
<html>
<head>
    <link rel="stylesheet" href="jquery.mobile-1.4.0.min.css">
    <script src="jquery-2.1.0.min.js"></script>
    <script src="jquery.mobile-1.4.0.min.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta charset="UTF-8" />
    <meta name="Description" content="" />
    <meta name="Keywords"  content="" />
</head>
<body>

<div data-role="page" id="mainPage" data-theme="b">
  <div data-role="header" data-position="fixed" >
    <h1>IAS Youth</h1>
      <a href="#contact" data-rel="dialog" data-role="button" class="ui-btn-right">Contact Us</a>
  </div>
    
  <div data-role="content">
      <p>"Allah says, 'I am as my servant expects Me to be, and I am with him when he remembers me. If he thinks of Me, I think of him. If he mentions Me in company, I mention him in an even better company. When he comes closer to Me by a handspan, I come closer to him an arm's length. If he draws closer to Me by an arm's length, I draw closer by a distance of two outstretched arms nearer to him. If my servant comes to Me walking, I go to him running." (Al-Bukhari)</p>
      <br>
    <a data-role="button" href="#prayerPage" data-transition="slide" >Prayer Timings</a>
    <a data-role="button" href="#EventsPage" data-transition="slide" >Upcoming Events</a>
  </div>

  <div data-role="footer" data-position="fixed" >
    <h1> </h1>
  </div>
</div> 

<div data-role="page" id="contact" data-theme="b">
  <div data-role="header">
    <h1>Contact Us</h1>
  </div>

  <div data-role="content">
    <p>Assalamu Alaykum, this is the Islamic Association of Saskatchewan (Youth), mobile application. Please feel free to contact us if you have any suggestions for improvement, or general questions.</p>
      <a data-icon="info" data-inline="true" data-role="button" href="mailto:iasyouthm@gmail.com?Subject=IAS%20App" target="_top">
Email Us</a>
  </div>

</div> 
    
<div data-role="page" id="prayerPage" data-theme="b">
  <div  data-role="header" data-position="fixed" >
      <a data-role="button" href="#" data-transition="slide" data-rel="back" data-icon="back">Back</a>
      <h1>Prayer Timings</h1>
      <a class="refresh" href="#" data-role="button" data-icon="refresh" data-iconpos="notext"></a>
  </div>
   
  <div data-role="content" id="yql">
    <label>“Prayer in congregation is superior to prayer alone by twenty seven degrees.” [Bukhari & Muslim]</label>
      <br>
    <div data-role="collapsible-set">
      <div data-role="collapsible" data-collapsed="true">
        <h1 id="eastPrayers" >East-side Masjid</h1>
        <div data-role="fieldcontain"><label for="fajr">Fajr: </label><label id="fajr"></label></div>
        <div data-role="fieldcontain"><label>Duhr: </label><label id="duhr"></label></div>
        <div data-role="fieldcontain"><label>Asr: </label><label id="asr"></label></div>
        <div data-role="fieldcontain"><label>Maghrib: </label><label id="maghrib"></label></div>
        <div data-role="fieldcontain"><label>Isha: </label><label id="isha"></label></div><br>
        <div data-role="fieldcontain"><label>Jumma 1: </label><label id="jumma1"></label></div>
        <div data-role="fieldcontain"><label>Jumma 2: </label><label id="jumma2"></label></div>
      </div>
      
      <div data-role="collapsible" data-collapsed="true">
        <h1 id="westPrayers" >West-side Masjid</h1>
        <div data-role="fieldcontain"><label>Fajr: </label><label id="fajrWest"></label></div>
        <div data-role="fieldcontain"><label>Duhr: </label><label id="duhrWest"></label></div>
        <div data-role="fieldcontain"><label>Asr: </label><label id="asrWest"></label></div>
        <div data-role="fieldcontain"><label>Maghrib: </label><label id="maghribWest"></label></div>
        <div data-role="fieldcontain"><label>Isha: </label><label id="ishaWest"></label></div><br>
        <div data-role="fieldcontain"><label>Jumma 1: </label><label id="jumma1West"></label></div>
        <div data-role="fieldcontain"><label>Jumma 2: </label><label id="jumma2West"></label></div>
      </div>
    </div>
   
  </div>

  <div data-role="footer" data-position="fixed" >
    <h1></h1>
  </div>
</div> 
    
<div data-role="page" id="EventsPage" data-theme="b">
  <div data-role="header" data-position="fixed" >
    <a data-role="button" href="#" data-transition="slide" data-rel="back" data-icon="back">Back</a>
      <h1>Events</h1>
      <a class="refresh" href="#" data-role="button" data-icon="refresh" data-iconpos="notext"></a>
  </div>

  <div data-role="content">
      <p>"None of you will believe until you love for your brother what you love for yourself." [Bukhari & Muslim]</p>
      <br>
      <div data-role="collapsible" data-collapsed="true">
          <h1 id="eastEvents">East-side Masjid</h1>
          
          <div data-role="collapsible-set">
              <div  data-role="collapsible" data-collapsed="false" >
                <h1>Brother Events<span id="bNum" class="ui-li-count ui-btn-up-c ui-btn-corner-all"></span></h1>
                <div id="B"></div>
              </div>
              
              <div  data-role="collapsible" data-collapsed="true">
                <h1>Sister Events <span id="sNum" class="ui-li-count ui-btn-up-c ui-btn-corner-all"></span></h1>
                <div id="S"></div>
              </div>
          </div>
      
      </div>
  </div>

  <div data-role="footer" data-position="fixed" >
    <h1> </h1>  
  </div>
</div> 

</body>
</html>

<script type="text/javascript" src="http://jsdo.it/laphroaig/json2/js"></script>
<script type="text/javascript" src="http://jsdo.it/laphroaig/jquery.yql/js"></script>

<script>
    $(function(){
        
        loadData(); 
        
        $('.refresh').click(function() {
           loadData(); 
         });
        
    }); 
    
    function loadData(){
        var fajrEast = "NA";
        var duhrEast = "NA";
        var asrEast= "NA"; 
        var maghribEast = "NA";
        var ishaEast = "NA"; 
        var jumma1East = "NA"; 
        var jumma2East = "NA";
                    
                
        var fajrWest = "NA";
        var duhrWest = "NA";
        var asrWest = "NA";
        var maghribWest = "NA";
        var ishaWest = "NA";
        var jumma1West = "NA";
        var jumma2West = "NA";
        
        var $yql = $("#yql");
        $.yql.getHTML('http://www.imamilyas.com/index.html', {
                xpath: '//div',
                format: 'json',
                callback: function(data){
                    
                    fajrEast = data.query.results.div[4].div.div[11].div.div.div.div.div.table.tbody.tr[0].td[1].p;
                    duhrEast = data.query.results.div[4].div.div[11].div.div.div.div.div.table.tbody.tr[1].td[1].p;
                    asrEast = data.query.results.div[4].div.div[11].div.div.div.div.div.table.tbody.tr[2].td[1].p;
                    maghribEast = data.query.results.div[4].div.div[11].div.div.div.div.div.table.tbody.tr[3].td[1].p;
                    ishaEast = data.query.results.div[4].div.div[11].div.div.div.div.div.table.tbody.tr[4].td[1].p;
                    jumma1East = data.query.results.div[4].div.div[11].div.div.div.div.div.table.tbody.tr[5].td[1].p;
                    jumma2East = data.query.results.div[4].div.div[11].div.div.div.div.div.table.tbody.tr[6].td[1].p;
                    
                    
                    fajrWest = data.query.results.div[4].div.div[12].div.div.div.div.div.table.tbody.tr[0].td[1].p;
                    duhrWest = data.query.results.div[4].div.div[12].div.div.div.div.div.table.tbody.tr[1].td[1].p;
                    asrWest = data.query.results.div[4].div.div[12].div.div.div.div.div.table.tbody.tr[2].td[1].p;
                    maghribWest = data.query.results.div[4].div.div[12].div.div.div.div.div.table.tbody.tr[3].td[1].p;
                    ishaWest = data.query.results.div[4].div.div[12].div.div.div.div.div.table.tbody.tr[4].td[1].p;
                    jumma1West = data.query.results.div[4].div.div[12].div.div.div.div.div.table.tbody.tr[5].td[1].p;
                    jumma2West = data.query.results.div[4].div.div[12].div.div.div.div.div.table.tbody.tr[6].td[1].p;
                    
                    
                    $('#fajr').html("<b>"+fajrEast +"</b>");
                    $('#duhr').html(duhrEast);
                    $('#asr').html(asrEast);
                    $('#maghrib').html(maghribEast);
                    $('#isha').html("<b>"+ishaEast+"</b>");
                    $('#jumma1').html(jumma1East);
                    $('#jumma2').html(jumma2East);
            
                    $('#fajrWest').html("<b>"+fajrWest+"</b>");
                    $('#duhrWest').html(duhrWest);
                    $('#asrWest').html(asrWest);
                    $('#maghribWest').html(maghribWest);
                    $('#ishaWest').html("<b>"+ishaWest+"</b>");
                    $('#jumma1West').html(jumma1West);
                    $('#jumma2West').html(jumma2West);
                }
        });
        
        
        
        
            
        
        
        var bCount = 0;
        var sCount = 0;
         $.getJSON( "http://iasforyouth.appspot.com/loadEvents?callback=?", function( json ) {
           $("#B").empty(); 
           $("#S").empty(); 
           json.forEach(function(event) {
               var showingDate = event.DateTime.slice(0,9).split("-");
               var showingTime = event.DateTime.slice(11,16); 
               
               var year = showingDate[0]; 
               var month = getMonth(showingDate[1]); 
               var day = showingDate[2];
               
               var finalDateTime = month + ", " + day + ", " + year + ". At " + tConvert(showingTime); 
               
               if(event.Gender == "Brother's Event"){
                   bCount ++;
                   $("#B").append("<fieldset><legend>"+event.Title+"</legend><ul>" +
                            "<li><label>"+finalDateTime+"</label></li>" +
                            "<li><label>"+event.Location+"</label></li>" +
                            "<li><label>"+event.Description+"</label></li>" +
                        "</ul></fieldset>"); 
               }else {
                   sCount ++; 
                   $("#S").append("<fieldset><legend>"+event.Title+"</legend><ul>" +
                            "<li><label>"+finalDateTime+"</label></li>" +
                            "<li><label>"+event.Location+"</label></li>" +
                            "<li><label>"+event.Description+"</label></li>" +
                        "</ul></fieldset>"); 
               }
           });
             $("#bNum").html(bCount); 
             $("#sNum").html(sCount); 
       }); 
    }
   
    

    
    
    
    function getMonth(num){
        var monthNames = [ "January", "February", "March", "April", "May", "June",
        "July", "August", "September", "October", "November", "December" ];
        num = parseInt(num); 
        
        return monthNames[num]; 
    }
    
    function tConvert (time) {
        // Check correct time format and split into components
        time = time.toString ().match (/^([01]\d|2[0-3])(:)([0-5]\d)(:[0-5]\d)?$/) || [time];

        if (time.length > 1) { // If time format correct
            time = time.slice (1);  // Remove full string match value
            time[5] = +time[0] < 12 ? 'AM' : 'PM'; // Set AM/PM
            time[0] = +time[0] % 12 || 12; // Adjust hours
        }
        
        return time.join (''); // return adjusted time or original string
    }
    
</script>
